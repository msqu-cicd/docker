name: 'Docker'
description: 'Build and publish docker images'

inputs:
  docker_image:
    description: docker client image to use for building images
    default: "docker:latest"

  docker_args:
    description: "Extra arguments to pass to docker invocation"
    default: ""

  tag_prefix:
    description: "a prefix to add to all docker tags"

  tag_suffix:
    description: "a suffix to add to all docker tags"

  tag_commit_enable:
    description: "generate docker tags for git tag if present"
    default: "true"

  tag_commit_prefix:
    description: "a suffix to add to docker tags that were generated from commit sha"
    default: "commit-"

  tag_ref_slug_enable:
    description: "generate a tag from the git ref slug"
    default: "false"

  tag_ref_normalized_enable:
    description: ""
    default: "true"

  tag_semver_major:
    description: ""
    default: "true"

  tag_semver_minor:
    description: ""
    default: "true"

  tag_semver_patch:
    description: ""
    default: "true"

  additional_registry_destinations:
    description: "a list of --destination registry/orga/repo:tag strings, space separated"
    default: ""

  squash_layers:
    description: ""
    default: "true"

  additional_registries:
    description: ""
    default: ""

  add_ci_registry_auth:
    description: ""
    default: "true"

  add_ci_registry_target:
    description: ""
    default: "true"

  registry_auth_json:
    description: ""
    default: ""

  merge_registry_json:
    description: ""
    default: "true"

  docker_push:
    description: "Push all build tags to destinations"
    default: "true"

  docker_pull:
    description: "Always attempt to pull all referenced images"
    default: "true"

  use_buildx:
    description: "use buildx instead of legacy build"
    default: "true"

  docker_multi_arch:
    description: ""
    default: "false"

  dockerfile:
    description: "Dockerfile used to build images"
    default: "Dockerfile"

  docker_context_dir:
    description: "${{ github.workspace }}"

  ci_registry_password:
    description: "password/token for default ci registry, should usually be set to secret value with ${{ secrets.someSecretName }} for gitea"
    default: ""
    required: false

  build_args:
    description: "list of docker build args to pass to docker (--build-arg key1=value1) as newline seperated multiline string, eg key1=value1\nkey2=value2"
    default: ""
    required: false

outputs:
  published_tags:
    description: "Published tags as csv"

runs:
  using: "node20"
  main: ./dist/index.js
